datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Company {
  id                  String   @id @default(cuid())
  name                String
  industry            String
  segment             String
  region              String
  headquartersLine1   String
  headquartersLine2   String?
  headquartersCity    String
  headquartersState   String
  headquartersPostal  String
  totalSampleRequests Int      @default(0)
  totalJobs           Int      @default(0)
  totalRevenue        Float    @default(0)
  lastEngagementDate  DateTime?
  healthScore         Int      @default(0)
  owner               String
  prospects           Prospect[]
  sampleRequests      SampleRequest[]
  jobs                Job[]
  tasks               Task[]
  payments            Payment[]
}

model Prospect {
  id                 String   @id @default(cuid())
  firstName          String
  lastName           String
  email              String   @unique
  phone              String?
  title              String?
  source             String
  persona            String
  stage              String
  region             String
  industry           String
  createdAt          DateTime @default(now())
  lastActivityAt     DateTime?
  engagementScore    Int      @default(0)
  sampleRequests     Int      @default(0)
  conversionLikelihood Float  @default(0)
  companyId          String
  company            Company  @relation(fields: [companyId], references: [id])
  jobs               Job[]
  tasks              Task[]
}

model SampleRequest {
  id             String   @id @default(cuid())
  prospectId     String
  companyId      String
  requestedAt    DateTime @default(now())
  fulfilledAt    DateTime?
  status         String
  shippingCarrier String?
  shippingTracking String?
  material       String
  quantity       Int
  source         String
  prospect       Prospect @relation(fields: [prospectId], references: [id])
  company        Company  @relation(fields: [companyId], references: [id])
}

model Job {
  id                     String   @id @default(cuid())
  companyId              String
  prospectId             String?
  description            String
  status                 String
  estimatedValue         Float
  actualValue            Float?
  createdAt              DateTime @default(now())
  dueDate                DateTime?
  conversionFromSampleDays Int?
  company                Company  @relation(fields: [companyId], references: [id])
  prospect               Prospect? @relation(fields: [prospectId], references: [id])
  payments               Payment[]
}

model Payment {
  id        String   @id @default(cuid())
  jobId     String
  companyId String
  amount    Float
  currency  String  @default("USD")
  paidAt    DateTime
  method    String
  status    String
  job       Job      @relation(fields: [jobId], references: [id])
  company   Company  @relation(fields: [companyId], references: [id])
}

model Task {
  id          String   @id @default(cuid())
  prospectId  String?
  companyId   String?
  title       String
  description String?
  status      String
  priority    String
  dueDate     DateTime?
  owner       String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  prospect    Prospect? @relation(fields: [prospectId], references: [id])
  company     Company?  @relation(fields: [companyId], references: [id])
}

model SavedFilter {
  id        String   @id @default(cuid())
  view      String
  name      String
  createdBy String
  filters   Json
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
}
